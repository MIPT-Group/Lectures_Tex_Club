\subsubsection*{Шифрование сообщений}

\begin{problem}
	Алиса и Боб хотят произвести обмен сообщениями по некоторому каналу связи. При этом они желают, чтобы любой человек, который перехватит сообщение, не смог его прочитать. Для этого они используют шифрование, основанное на степенях первообразного корня по некоторому модулю $m$. (Например, $m \approx 10^{100}$)
\end{problem}

\begin{solution}
	Алиса и Боб фиксируют числа $a$ и $b$ соответственно, которые знают только они. Всем известен модуль $m$ и то, что у него есть первообразный корень $g$. Далее Алиса высчитывает число $g^a \pmod m$, а Боб - $g^b \pmod m$ и передают их друг-другу по каналу. Теперь, если Алиса возведёт число Боба в степень $a$ по модулю, а Боб возведёт её число в степень $b$, то они получат \textit{ключ} $ab$, который не будет известен никому кроме них. (В предположении, что вычисление индекса - крайне трудоёмкая задача). Далее с этим ключом они уже могут делать что угодно.
\end{solution}

\begin{theorem}
	Если $m = 2^\alpha,\ \alpha \ge 3$, то первообразного корня для такого модуля $m$ не существует.
\end{theorem}

\begin{note}
	Для $m = 2$ естественно корнем будет 1, а для $m = 4$ корнем будет 3.
\end{note}

\begin{proof}
	Заметим, что при таком модуле все взаимно простые с модулем числа - это все нечётные числа. Рассмотрим любое такое $a$:
	\begin{align*}
		&{a = 1 + 2t_0}
		\\
		&{a^2 = (1 + 2t_0)^2 = 1 + 4t_0 + 4t_0^2 = 1 + 4\underbrace{t_0(1 + t_0)}_{\text{делится на } 2} = 1 + 8t_1}
		\\
		&{\vdots}
		\\
		&{a^{2^k} = 1 + 2^{k + 2} \cdot t_k}
	\end{align*}
	Подставим $k = \alpha - 2$:
	\[
		a^{2^{\alpha - 2}} = 1 + 2^{\alpha} \cdot t_{\alpha - 2} \equiv 1 \pmod m
	\]
	А взаимно простых с $m$ чисел $\phi(m) = 2^{\alpha - 1} > 2^{\alpha - 2}$.
\end{proof}

\begin{theorem}
	По модулю любого нечётного простого числа $p$ существует первообразный корень.
\end{theorem}

\begin{proof}
	Рассмотрим приведённую систему вычетов $\{1, \ldots, p - 1\}$. У каждого числа в ней есть свой показатель, которые мы обозначим за $\{\delta_1, \ldots, \delta_{p - 1}\}$. Определим число $\tau$ - НОК этих показателей:
	\[
		\tau := [\delta_1, \ldots, \delta_{p - 1}] \le p - 1
	\]
	Теперь наша цель - построить некоторое число с показателем $\tau$ и доказать, что $\tau$ в точности равно $p - 1$.
	\begin{enumerate}
		\item Разложим число $\tau$ на простые сомножители:
		\[
			\tau = q_1^{k_1} \cdot \ldots \cdot q_s^{k_s}
		\]
		Из свойств НОКа известно, что любой $k_i$ - это максимум степеней у $\{\delta_1, \ldots, \delta_{p - 1}\}$. Следовательно
		\[
			\forall i \in \{1, \ldots, s\}\ \exists \delta \in \{\delta_1, \ldots, \delta_s\} \such \delta = a \cdot q_i^{k_i}
		\]
		То есть можно определить некоторую функцию, которая по $i$ будет выдавать соответствующие $\delta$ и $a$.
		
		На время зафиксируем некоторое такое $i$ и соответствующие ему $\delta$ и $a$. Рассмотрим тот $x \in \{1,\ldots, p - 1\}$, у которого $\delta$ служит показателем. Тогда заметим следующие вещи:
		\begin{proposition}
			$x^a$ имеет показатель $q_i^{k_i}$.
		\end{proposition}
		
		\begin{proof}
			Посмотрим на $x^a$ в данной степени:
			\[
				(x^a)^{q_i^{k_i}} = x^{aq_i^{k_i}} = x^\delta \equiv 1 \pmod p
			\]
			При этом понятно, что меньшего показателя найтись не могло - было бы противоречие с тем, что само $\delta$ является показателем числа $x$.
		\end{proof}
	
		\begin{proposition}
			Если у некоторых чисел $u, v$ показатели $\delta_u$, $\delta_v$ взаимно просты, то показателем $uv$ будет $\delta_u \cdot \delta_v$ (В предположении модуля $p$).
		\end{proposition}
	
		\begin{proof}
			Для начала удостоверимся, что такая степень сойдёт за показатель:
			\[
				(uv)^{\delta_u\delta_v} = (u^{\delta_u})^{\delta_v} \cdot (v^{\delta_v})^{\delta_u} \equiv 1 \pmod p
			\]
			\textcolor{red}{Пока дальше не пошло, а затехать остальное надо.}
		\end{proof}
	
		Из этих утверждений следует, что произведение $x$ по всем $i$ даёт число, у которого показатель ровно $\tau$.
		
		\item Рассмотрим сравнение следующего вида:
		\[
			y^{\tau} \equiv 1 \pmod p
		\]
		По уже доказанной теореме Лагранжа, у него не более $\tau$ корней. Но при этом известно, что любое число из $\{1, \ldots, p - 1\}$ является его корнем, так как $\tau$ - НОК их показателей. Отсюда имеем, что $p - 1 \le \tau \le p - 1$, то есть $\tau = p - 1$.
	\end{enumerate}
\end{proof}

\begin{theorem}
	Для любого $\alpha \ge 1$ первообразный корень по модулю $p^\alpha$ тоже существует, если $p$ - нечётное простое число.
\end{theorem}

\begin{proof}
	Рассмотрим $g$ - первообразный корень по модулю $p$.
	
	\begin{lemma}
		Существует такое $t$ и $u(t)$, что выполнено равенство
		\[
			(g + pt)^{p - 1} = 1 + pu,\ (u, p) = 1
		\]
	\end{lemma}

	\begin{proof}
		Распишем степень $g + pt$ по биному Ньютона:
		\[
			(g + pt)^{p - 1} = g^{p - 1} + (p - 1)g^{p - 2} \cdot pt + p^2 v
		\]
		где $v$ просто обозначает части оставшихся слагаемых. При этом
		\[
			g^{p - 1} \equiv 1 \pmod p \lra g^{p - 1} = 1 + pw
		\]
		Подставим это равенство в первое:
		\[
			(g + pt)^{p - 1} = 1 + p(w + (p - 1)g^{p - 2}t + pv)
		\]
		Заметим, что $(p - 1)g^{p - 2}$ - взаимно просто с $p$, так как $g^{p - 2}$ это фактически обратное число к $g$ по модулю $p$, а стало быть точно не кратно ему. Отсюда получаем метод нахождения $u$:
		\begin{enumerate}
			\item Если $w + pv \equiv 0 \pmod p$, то положим $t = 1$.
			\item Иначе возьмём $t = 0$.
		\end{enumerate}
		Оба случая дают требуемое условие на $u$.
	\end{proof}

	\begin{proposition}
		$g + pt$ - искомый первообразный корень по модулю $p^\alpha$ (то есть он одинаков для всех $\alpha$).
	\end{proposition}

	\begin{proof}
		Показатель первообразного корня всегда совпадает с функцией Эйлера от модуля по определению. В нашем случае это будет
		\[
			\delta = \phi(p^\alpha) = p^\alpha - p^{\alpha - 1} = p^{\alpha - 1}(p - 1)
		\]
		Понятно, что раз $(g + pt)^\delta \equiv 1 \pmod {p^\alpha}$, то и $(g + pt)^\delta \equiv 1 \pmod p$. Отсюда следует, что $(p - 1) \mid \delta$, то есть $\delta$ может иметь лишь вид
		\[
			\delta = p^k (p - 1),\ k \in \{0, \ldots, \alpha - 1\}
		\]
		Остаётся посмотреть на степени $g + pt$, соответствующие кандидатам на $\delta$:
		\begin{align*}
			&{(g + pt)^{p - 1} = 1 + pu,\ (p, u) = 1}
			\\
			&{(g + pt)^{p(p - 1)} = (1 + pu)^p = 1 + p^2u + p^3v = 1 + p^2\underbrace{(u + pv)}_{\equiv u \pmod p} = 1 + p^2u_1,\ (u_1, p) = 1}
			\\
			&{\vdots}
			\\
			&{(g + pt)^{p(p^{k - 1}(p - 1))} = (1 + p^k u_{k - 1})^p = 1 + p^{k + 1}u_k,\ (u_k, p) = 1}
		\end{align*}
		Подставим $k = \alpha - 1$. Тогда
		\[
			(g + pt)^{p^{\alpha - 1}(p - 1)} = 1 + p^\alpha u_{\alpha - 1},\ (u_{\alpha - 1}, p) = 1
		\]
		Следовательно, только начиная с $k = \alpha - 1$ будет возможно, что
		\[
			(g + pt)^k \equiv 1 \pmod p
		\]
	\end{proof}
\end{proof}

\begin{theorem}
	Для любого $\alpha \ge 1$ первообразный корень по модулю $2p^\alpha$ тоже существует, если $p$ - нечётное простое число.
\end{theorem}

\begin{proof}
	Заметим, что $\phi(2p^\alpha) = \phi(p^\alpha)$. Пусть $g$ - первообразный корень по модулю $p^\alpha$. Тогда есть 2 варианта:
	\begin{enumerate}
		\item Если $g$ - нечётное число, то $(g, 2p^\alpha) = 1$ и применима теорема Эйлера:
		\[
			g^{\phi(2p^\alpha)} \equiv 1 \pmod {2p^\alpha}
		\]
		
		\item Иначе нам подойдёт число $g + p^\alpha$, которое остаётся первообразным корнем по модулю $p^\alpha$ и к нему уже применима теорема Эйлера.
	\end{enumerate}
\end{proof}

\begin{theorem} (не входит в программу)
	Первообразные корни существуют только по модулям $2$, $4$, $p^\alpha$ и $2p^\alpha$ для $\alpha \ge 1$ и $p$ - простого нечётного числа.
\end{theorem}